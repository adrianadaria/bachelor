!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-interpolate"],t):t(n.d3_sankey=n.d3_sankey||{},n.d3_array,n.d3_collection,n.d3_interpolate)}(this,function(n,t,r,e){"use strict";function o(){function n(){L.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),E.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=L[n.source]),"number"==typeof r&&(r=n.target=L[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function o(){L.forEach(function(n){n.value=Math.max(t.sum(n.sourceLinks,h),t.sum(n.targetLinks,h))})}function u(){for(var n,t=L,r=0,e="right"===v;t.length;)n=[],t.forEach(function(t){t.x=r,t.dx=d,t[e?"targetLinks":"sourceLinks"].forEach(function(t){var r=t[e?"source":"target"];n.indexOf(r)<0&&n.push(r)})}),t=n,++r;e&&L.forEach(function(n){n.x*=-1,n.x+=r-1}),"center"===v&&i(),"justify"===v&&c(r),f((k[0]-d)/(r-1))}function i(){L.slice().sort(function(n,t){return t.x-n.x}).forEach(function(n){n.targetLinks.length||(n.x=t.min(n.sourceLinks,function(n){return n.target.x})-1)})}function c(n){L.forEach(function(t){t.sourceLinks.length||(t.x=n-1)})}function f(n){L.forEach(function(t){t.x*=n})}function a(n){function e(){var n=t.min(f,function(n){return(k[1]-(n.length-1)*g)/t.sum(n,h)});f.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),E.forEach(function(t){t.dy=t.value*n})}function o(n){function r(n){return y(n.source)*n.value}f.forEach(function(e){e.forEach(function(e){if(e.targetLinks.length){var o=t.sum(e.targetLinks,r)/t.sum(e.targetLinks,h);e.y+=(o-y(e))*n}})})}function u(n){function r(n){return y(n.target)*n.value}f.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var o=t.sum(e.sourceLinks,r)/t.sum(e.sourceLinks,h);e.y+=(o-y(e))*n}})})}function i(){f.forEach(function(n){var t,r,e,o=0,u=n.length;for(n.sort(c),e=0;e<u;++e)t=n[e],r=o-t.y,r>0&&(t.y+=r),o=t.y+t.dy+g;if(r=o-g-k[1],r>0)for(o=t.y-=r,e=u-2;e>=0;--e)t=n[e],r=t.y+t.dy+g-o,r>0&&(t.y-=r),o=t.y})}function c(n,t){return n.y-t.y}var f=r.nest().key(function(n){return n.x}).sortKeys(t.ascending).entries(L).map(function(n){return n.values});e(),i();for(var a=1;n>0;--n)u(a*=.99),i(),o(a),i()}function s(){function n(n,t){return n.source.y-t.source.y}function t(n,t){return n.target.y-t.target.y}L.forEach(function(r){r.sourceLinks.sort(t),r.targetLinks.sort(n)}),L.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function y(n){return n.y+n.dy/2}function h(n){return n.value}var l={},d=24,g=8,k=[1,1],v="justify",L=[],E=[];return l.nodeWidth=function(n){return arguments.length?(d=+n,l):d},l.nodePadding=function(n){return arguments.length?(g=+n,l):g},l.nodes=function(n){return arguments.length?(L=n,l):L},l.links=function(n){return arguments.length?(E=n,l):E},l.size=function(n){return arguments.length?(k=n,l):k},l.align=function(n){return arguments.length?(v=n.toLowerCase(),l):v},l.layout=function(t){return n(),o(),u(),a(t),s(),l},l.relayout=function(){return s(),l},l.link=function(){function n(n){var r=n.source.x+n.source.dx,o=n.target.x,u=e.number(r,o),i=u(t),c=u(1-t),f=n.source.y+n.sy+n.dy/2,a=n.target.y+n.ty+n.dy/2;return"M"+r+","+f+"C"+i+","+f+" "+c+","+a+" "+o+","+a}var t=.5;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},l}var u="0.1.0";n.version=u,n.sankey=o,Object.defineProperty(n,"__esModule",{value:!0})});